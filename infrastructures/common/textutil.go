package common

import (
	"strconv"
)

// ChineseToArabicMap 中文数字到阿拉伯数字的映射表（1-99完整覆盖）
var ChineseToArabicMap = map[string]string{
	// 基础中文数字
	"零": "0", "〇": "0",
	"一": "1", "二": "2", "三": "3", "四": "4", "五": "5",
	"六": "6", "七": "7", "八": "8", "九": "9", "十": "10",

	// 特殊表达
	"两": "2", "俩": "2", "仨": "3",

	// 大写中文数字
	"壹": "1", "贰": "2", "叁": "3", "肆": "4", "伍": "5",
	"陆": "6", "柒": "7", "捌": "8", "玖": "9", "拾": "10",

	// 复合数字（11-19）
	"十一": "11", "十二": "12", "十三": "13", "十四": "14", "十五": "15",
	"十六": "16", "十七": "17", "十八": "18", "十九": "19",

	// 整十数字（20-90）
	"二十": "20", "三十": "30", "四十": "40", "五十": "50",
	"六十": "60", "七十": "70", "八十": "80", "九十": "90",

	// 21-29
	"二十一": "21", "二十二": "22", "二十三": "23", "二十四": "24", "二十五": "25",
	"二十六": "26", "二十七": "27", "二十八": "28", "二十九": "29",

	// 31-39
	"三十一": "31", "三十二": "32", "三十三": "33", "三十四": "34", "三十五": "35",
	"三十六": "36", "三十七": "37", "三十八": "38", "三十九": "39",

	// 41-49
	"四十一": "41", "四十二": "42", "四十三": "43", "四十四": "44", "四十五": "45",
	"四十六": "46", "四十七": "47", "四十八": "48", "四十九": "49",

	// 51-59
	"五十一": "51", "五十二": "52", "五十三": "53", "五十四": "54", "五十五": "55",
	"五十六": "56", "五十七": "57", "五十八": "58", "五十九": "59",

	// 61-69
	"六十一": "61", "六十二": "62", "六十三": "63", "六十四": "64", "六十五": "65",
	"六十六": "66", "六十七": "67", "六十八": "68", "六十九": "69",

	// 71-79
	"七十一": "71", "七十二": "72", "七十三": "73", "七十四": "74", "七十五": "75",
	"七十六": "76", "七十七": "77", "七十八": "78", "七十九": "79",

	// 81-89
	"八十一": "81", "八十二": "82", "八十三": "83", "八十四": "84", "八十五": "85",
	"八十六": "86", "八十七": "87", "八十八": "88", "八十九": "89",

	// 91-99
	"九十一": "91", "九十二": "92", "九十三": "93", "九十四": "94", "九十五": "95",
	"九十六": "96", "九十七": "97", "九十八": "98", "九十九": "99",
}

// ChineseToArabicExtended 扩展的中文数字映射（包含大单位）
var ChineseToArabicExtended = map[string]float64{
	// 基础数字
	"零": 0, "〇": 0,
	"一": 1, "二": 2, "三": 3, "四": 4, "五": 5,
	"六": 6, "七": 7, "八": 8, "九": 9, "十": 10,

	// 特殊表达
	"两": 2, "俩": 2, "仨": 3,

	// 大写中文数字
	"壹": 1, "贰": 2, "叁": 3, "肆": 4, "伍": 5,
	"陆": 6, "柒": 7, "捌": 8, "玖": 9, "拾": 10,

	// 单位
	"百": 100, "千": 1000, "万": 10000, "亿": 100000000,
}

// ConvertChineseToArabic 将中文数字转换为阿拉伯数字字符串
// 支持基础中文数字、大写中文数字、复合数字（如"十一"）
// 如果无法转换，返回原始字符串
func ConvertChineseToArabic(text string) string {
	// 优先查找完整匹配（处理复合数字）
	if arabic, exists := ChineseToArabicMap[text]; exists {
		return arabic
	}

	// 如果已经是数字，直接返回
	if _, err := strconv.Atoi(text); err == nil {
		return text
	}

	// 无法转换，返回原始文本
	return text
}

// ConvertChineseToInt 将中文数字转换为整数
// 支持基础中文数字、大写中文数字、阿拉伯数字字符串
// 如果无法转换，返回0
func ConvertChineseToInt(text string) int {
	// 先尝试转换为阿拉伯数字字符串
	arabicStr := ConvertChineseToArabic(text)

	// 尝试解析为整数
	if num, err := strconv.Atoi(arabicStr); err == nil {
		return num
	}

	// 如果还是无法转换，返回0
	return 0
}

// ConvertChineseToFloat 将中文数字转换为浮点数
// 支持基础中文数字、大写中文数字、单位（百、千、万、亿）
// 如果无法转换，返回0
func ConvertChineseToFloat(text string) float64 {
	// 先检查扩展映射表
	if value, exists := ChineseToArabicExtended[text]; exists {
		return value
	}

	// 尝试转换为整数
	if num := ConvertChineseToInt(text); num != 0 {
		return float64(num)
	}

	// 尝试直接解析为浮点数
	if num, err := strconv.ParseFloat(text, 64); err == nil {
		return num
	}

	return 0
}

// NormalizeChineseNumbers 在文本中标准化中文数字
// 这是原 normalizeChineseNumbers 的通用版本
func NormalizeChineseNumbers(text string) string {
	// 对于简单的数字转换，直接返回转换结果
	return ConvertChineseToArabic(text)
}